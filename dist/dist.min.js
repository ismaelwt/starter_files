!function(){"use strict";function t(t,e,n,r){e.otherwise("/"),n.html5Mode(!0),r.interceptors.push("authInterceptor")}function e(t,e,n){t.$on("$stateChangeStart",function(t,r){n.isLoggedInAsync(function(t){r.authenticate&&!t&&e.path("/login")})})}function n(t,e,n,r){return{request:function(t){return t.headers=t.headers||{},n.get("token")&&(t.headers.Authorization="Bearer "+n.get("token")),t},responseError:function(t){return 401===t.status?(r.path("/login"),n.remove("token"),e.reject(t)):e.reject(t)}}}angular.module("app",["ngCookies","ngSanitize","ngResource","ui.router","ngAnimate","ngFileUpload","angularGrid","angularMoment","mgcrea.ngStrap"]).config(t).run(e).factory("authInterceptor",n),t.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider"],e.$inject=["$rootScope","$location","Auth"],n.$inject=["$rootScope","$q","$cookieStore","$location"]}(),function(){"use strict";function t(t){t.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0}).state("forgotpassword",{url:"/forgotpassword",templateUrl:"app/account/forgotpassword/forgotpassword.html",controller:"ForgotPasswordCtrl",authenticate:!0})}angular.module("app").config(t),t.$inject=["$stateProvider"]}(),function(){"use strict";function t(t,e,n){t.user=n.getCurrentUser()}angular.module("app").controller("MainCtrl",t),t.$inject=["$scope","$state","Auth"]}(),function(){"use strict";function t(t){t.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl",authenticate:!0})}angular.module("app").config(t),t.$inject=["$stateProvider"]}(),function(){"use strict";angular.module("app").controller("ForgotPasswordCtrl",function(t,e){t.errors={},t.reset=function(n){t.submitted=!0,n.$valid&&e.post("http://localhost:9000/forgotpassword/?email="+t.user.email).then(function(){t.message="An email with your new password has been sent to your email address."})}})}(),function(){"use strict";function t(t,e,n,r){t.user={},t.errors={},t.login=function(r){t.submitted=!0,r.$valid&&e.login({email:t.user.email,password:t.user.password}).then(function(){n.go("main")}).catch(function(e){t.errors.other=e.message})},t.loginOauth=function(t){r.location.href="/auth/"+t}}angular.module("app").controller("LoginCtrl",t),t.$inject=["$scope","Auth","$state","$window"]}(),angular.module("app").controller("SettingsCtrl",function(t,e,n){t.errors={},t.changePassword=function(e){t.submitted=!0,e.$valid&&n.changePassword(t.user.oldPassword,t.user.newPassword).then(function(){t.message="Password successfully changed."}).catch(function(){e.password.$setValidity("mongoose",!1),t.errors.other="Incorrect password",t.message=""})}}),function(){"use strict";function t(t,e,n,r){t.user={},t.errors={},e.isLoggedIn()&&n.go("main"),t.register=function(r){t.submitted=!0,r.$valid&&e.createUser({name:t.user.name,email:t.user.email,password:t.user.password}).then(function(){n.go("main")}).catch(function(e){e=e.data,t.errors={},angular.forEach(e.errors,function(e,n){r[n].$setValidity("mongoose",!1),t.errors[n]=e.message})})},t.loginOauth=function(t){r.location.href="/auth/"+t}}angular.module("app").controller("SignupCtrl",t),t.$inject=["$scope","Auth","$state","$window"]}(),function(t,e,n){function r(t){return t.complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)}function o(t){return Array.prototype.slice.call(t)}var i={gridWidth:300,gutterSize:10,refreshOnImgLoad:!0},a=function(){var n=t.element(e);return function(t){return n[0]=t,n}}();t.element(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important; visibility:hidden; opacity:0;}</style>"),t.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(e,n,s,u){return{restrict:"A",link:function(l,c,d){function g(){var t=v.offsetWidth;$=Math.floor(t/(S.gridWidth+S.gutterSize));var e=t%(S.gridWidth+S.gutterSize)+S.gutterSize;w=S.gridWidth+Math.floor(e/$),p.css({width:w+"px",height:"auto"}),P.length=0;for(var n=0;n<$;n++)P.push(0);return w}function f(){var e,n,r=g();o(p.find("img")).forEach(function(e){var n=t.element(e);if(n.hasClass("img-loaded"))return void n.css("height","");var r,o=n.attr("actual-width")||n.attr("data-actual-width"),i=n.attr("actual-height")||n.attr("data-actual-height");o&&i&&(r=e.width,d=i*r/o,n.css("height",d+"px"))});var i,s,u,l=[];for(e=0,n=p.length;e<n;e++)i=p[e],s=a(i),u=s.clone(),u.addClass("ag-no-transition"),u.css("width",r+"px"),s.after(u),l.push(u[0].offsetHeight),u.remove();for(e=0,n=p.length;e<n;e++){i=a(p[e]);var d=l[e],f=Math.min.apply(Math,P),h=P.indexOf(f);P[h]=f+d+S.gutterSize;var m=h*(r+S.gutterSize);i.css({top:f+"px",left:m+"px"})}c.css("height",Math.max.apply(Math,P)+"px")}function h(){var n=!1;o(p).forEach(function(i){var a=t.element(i),u=a.find("img"),l=[];u.length&&(a.addClass("img-loading"),o(u).forEach(function(o){var i=t.element(o);r(o)?i.addClass("img-loaded"):l.push(s(function(t,r){i.addClass("img-loading"),o.onload=function(){!n&&S.refreshOnImgLoad&&(n=!0,e(function(){f(),n=!1},100)),i.removeClass("img-loading").addClass("img-loaded"),t()},o.onerror=r}))}),l.length?s.all(l).then(function(){a.removeClass("img-loading").addClass("img-loaded")},function(){a.removeClass("img-loading").addClass("img-loaded")}):a.removeClass("img-loading").addClass("img-loaded"))})}var p,m,$,w,v=c[0],C=t.element(n),y=d.angularGridId,k=d.angularGrid,P=[],S={gridWidth:d.gridWidth?parseInt(d.gridWidth):i.gridWidth,gutterSize:d.gutterSize?parseInt(d.gutterSize):i.gutterSize,refreshOnImgLoad:"false"!==d.refreshOnImgLoad};l.$watch(k,function(){e(function(){p=c.children(),f(),h(),e(function(){c.addClass("angular-grid"),f()})})},!0),C.on("resize",function(){m&&e.cancel(m),m=e(function(){f()},100)}),y&&(u[y]={refresh:f})}}}]).factory("angularGridInstance",function(){return{}})}(angular,window),function(){"use strict";function t(t,e,n,r,o,i){var a={};return o.get("token")&&(a=r.get()),{login:function(t,e){var s=e||angular.noop,u=i.defer();return n.post("/auth/local",{email:t.email,password:t.password}).success(function(e){return o.put("token",e.token),o.put("authTokenCookie",t.email),a=r.get(),u.resolve(e),s()}).error(function(t){return this.logout(),u.reject(t),s(t)}.bind(this)),u.promise},logout:function(){o.remove("token"),o.remove("authTokenCookie"),a={}},createUser:function(t,e){var n=e||angular.noop;return r.save(t,function(e){return o.put("token",e.token),a=r.get(),n(t)},function(t){return this.logout(),n(t)}.bind(this)).$promise},changePassword:function(t,e,n){var o=n||angular.noop;return r.changePassword({id:a._id},{oldPassword:t,newPassword:e},function(t){return o(t)},function(t){return o(t)}).$promise},getCurrentUser:function(){return a},isLoggedIn:function(){return a.hasOwnProperty("role")},isLoggedInAsync:function(t){a.hasOwnProperty("$promise")?a.$promise.then(function(){t(!0)}).catch(function(){t(!1)}):t(a.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===a.role},getToken:function(){return o.get("token")},getUserEmail:function(){return a.email}}}angular.module("app").factory("Auth",t),t.$inject=["$location","$rootScope","$http","User","$cookieStore","$q"]}(),function(){"use strict";function t(t){return t("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}angular.module("app").factory("User",t),t.$inject=["$resource"]}(),angular.module("app").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,r){e.on("keydown",function(){return r.$setValidity("mongoose",!0)})}}}),angular.module("app").controller("NavbarCtrl",function(t,e,n){t.menu=[{title:"Home",link:"/"}],t.isCollapsed=!0,t.isLoggedIn=n.isLoggedIn,t.isAdmin=n.isAdmin,t.getCurrentUser=n.getCurrentUser,t.logout=function(){n.logout(),e.path("/login")},t.isActive=function(t){return t===e.path()}});